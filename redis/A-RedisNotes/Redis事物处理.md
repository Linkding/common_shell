[TOC]

**众所周知，事务是指“一个完整的动作，要么全部执行，要么什么也没有做”。**

# 1 事务处理基础
## 1.1 四个重要的redis命令
- MULTI——组装一个事务
- EXEC——执行一个事务
- DISCARD——取消一个事务
- WATCH——监视一些key，一旦这些key在事务执行之前被改变，则取消事务执行

## 1.2 事务相关的错误
- 调用EXEC之前的错误  
    有可能是由于语法有误导致的，也可能时由于内存不足导致的。只要出现某个命令无法成功写入缓冲队列的情况，redis都会进行记录，在客户端调用EXEC时，redis会拒绝执行这一事务。
- 调用EXEC之后的错误  
    不会理睬这些错误，而是继续向下执行事务中的其他命令。这是因为，对于应用层面的错误，并不是redis自身需要考虑和处理的问题，所以一个事务中如果某一条命令执行失败，并不会影响接下来的其他命令的执行。

## 1.3 WATCH命令
- 实现类似于“乐观锁”的效果，即CAS（check and set）

- 作用：监控key是否被改动过，支持同时监控多个key；一旦发现某个key被修改，在执行EXEC时候回返回nil，表示事务无法触发